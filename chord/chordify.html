<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="chordify.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="chordify.data.js"></script>
  <script src="chordify.js"></script>
  <script type="module">
    import { Canvg } from 'https://cdn.skypack.dev/canvg@^4.0.0';

    window.onload = async () => {
      const canvas = document.querySelector('canvas');
      const ctx = canvas.getContext('2d');
      const url = "./svg/E_min.svg";
      const v = await Canvg.from(ctx, url);


      v.resize(400, 400);
      v.start();


      const scaleImage = (ratio) => {
        const imageData = ctx.getImageData(0, 0, 400, 400),
          newCanvas = $("<canvas>")
            .attr("width", imageData.width * ratio)
            .attr("height", imageData.height * ratio)[0];
        const newCtx = newCanvas.getContext("2d");
        newCtx.scale(ratio, ratio);
        newCtx.drawImage(canvas, 0, 0);
        return newCanvas.toDataURL('image/png');
      }

      const bImage = scaleImage(0.8),
        mImage = scaleImage(0.4),
        sImage = scaleImage(0.2);
      document.getElementById('chord-img-L').src = bImage;
      document.getElementById('chord-img-M').src = mImage;
      document.getElementById('chord-img-S').src = sImage;

      window.onbeforeunload = () => {
        v.stop();
      };
    };

  </script>
</head>

<body>
  <canvas class="chord" id="chord"></canvas>
  <div class="chord-images">
    <img id="chord-img-L" class="image-large" />
    <img id="chord-img-M" class="image-medium" />
    <img id="chord-img-S" class="image-small" />
  </div>
  <button class="copy-icon" id="copy-button">Copy to Clipboard</button>
  <span id="status-text"></span>
  <hr />
  <div id="links" class="links"></div>
</body>

</html>